Certified Kubernetes Administrator course - NOTES

CLUSTER ARHITECTURE:
KUBERNETIC CLUSTER 
-a set of NODES physical/virtual on premises/on cloud that hosts applications in the form of a container
-contains WORKER NODES and a MASTER NODE(mamage worker nodes using control plane components)
ON MASTER we have: 
-ETCD CLUSTER- a database that stores information in a key/value format 
-KUBE-SCHEDULER - identifies the right node to place a container on 
-KUBE CONTROLLER - Node Controller, Replication Controller 
-KUBE-APISERVER - primary management component of kubernetics 
ON WORKER nodes we have:
-KUBELET - an agent that runs on each node on a cluster -listens from instructions from apiserver 
-KUPE-PROXY that helps enabling communication between services in the cluster 

ETCD Cluster - stores informations about Nodes, pods, configs, secrets, accounts, roles, bindings 
  -is installed on master node
  -listens on port 2379 

KUBE-API SERVER - the only component that interact directly with the ETCD Cluster
  -is responsible for authenticating and validating requests, retriving data, updating the ETCD, 
interacting with Scheduler and Kubelet(they are using the Kube-api to perform updates in the cluster)

KUBE CONTROLLER - a process that continously monitors the status of the cluster 
- Node Controller - checks the health of the nodes 
- Replication Controllers - monitors the status of replica sets- assures the desired number of pods 
-all controllers are installed in Kube-Controller-Manager 

-KUBE-SCHEDULER - decides with pods goes on which node (only decides, not place it) 
-KUBELET - register Node, create PODs, monitors Node and PODs (kubeadmn dos not automatically deploys kubelet)
-KUPE-PROXY - is a process that runs on each node in cluster 
-looks for new servicess, and every time a new service is created it creates the rulles to fwd traffic to pods
-uses ip-table rulles 

pod_def.yml
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
  type: front-end
spec:
  containers:
    - name: nginx-controller
	  image: nginx

Commands:
# Generate POD Manifest YAML file (-o yaml)
kubectl run nginx --image=nginx --dry-run=client -o yaml
kubectl create -f pod-definition.yml
kubectl get pods
kubectl describe pod myapp-pod

Example - Create a new pod with the name redis and the image redis123.
controlplane ~ ➜  kubectl run redis --image=redis123 --dry-run=client -o yaml > redis-definition.yaml
controlplane ~ ➜  kubectl create -f redis-definition.yaml
pod/redis created

ReplicationController:
kubectl create -f rc-definition.yml
kubectl get replicationController

ReplicaSets:
controlplane ~ ✖ cat replicaset-definition-1.yaml 
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: replicaset-1
spec:
  replicas: 2
  selector:
    matchLabels:
      tier: frontend
  template:
    metadata:
      labels:
        tier: frontend
    spec:
      containers:
      - name: nginx
        image: nginx

kubectl create -f replicaset-definition.yml
kubectl get replicaset
kubectl replace -f replicaset-definition.yml #if we want to update the nr of replicas
kubectl scale --replicas=6 replicaset-definition.yml # se poate face si cu scale dar in yaml raman tot 3 setate
kubectl scale --replicas=6 replicaset myapp-replicaset 
kubectl edit  replicasets new-replica-set  # edit something in the replicaset def- delete pods to apply changes

DEPLOYMENTS - provides the capabilities to perform upgrades seemlessly using rolling updates, undo changes

apiVersion: apps/v1
kind: Deployment
metadata:
  name: httpd-frontend
spec:
  replicas: 3
  selector:
    matchLabels:
      name: httpd-frontend-pod
  template:
    metadata:
      labels:
        name: httpd-frontend-pod
    spec:
      containers:
      - name: httpd-frontend
        image: httpd:2.4-alpine

Commands:
#Generate Deployment YAML file (-o yaml)
kubectl create deployment --image=nginx nginx --dry-run=client -o yaml
kubectl create deployment --image=nginx nginx --dry-run=client -o yaml > nginx-deployment.yaml
kubectl create -f deployment-definition.yaml
kubectl create deployment --image=nginx nginx --replicas=4 --dry-run=client -o yaml > nginx-deployment.yaml
kubectl get deployments
kubectl get replicaset
kubectl get pods
kubectl get all- vezi toate cele 3 de sus 




